# LND + btcd Simnet Stack
#
# This docker-compose runs LND with btcd backend in simnet mode.
# Simnet is useful for fast testing without needing real blockchain data.
#
# Usage:
#   docker-compose -f docker-compose-btcd.yml up -d --build
#   docker-compose -f docker-compose-btcd.yml down
#   docker-compose -f docker-compose-btcd.yml down -v   # Remove volumes
#
# btcd RPC (from host): localhost:18556
# LND gRPC (from host): localhost:10009
# LND REST (from host): localhost:8080
# LND P2P (from host): localhost:9735

services:
  btcd:
    build:
      context: ${LND_SOURCE:-/users/roasbeef/gocode/src/github.com/lightningnetwork/lnd}/docker/btcd
    image: btcd:local
    container_name: lnd-btcd
    restart: unless-stopped
    environment:
      - RPCUSER=devuser
      - RPCPASS=devpass
      - NETWORK=simnet
      - BTCD_DEBUG=info
      - MINING_ADDRESS=${MINING_ADDRESS:-}
    entrypoint: ["./start-btcd.sh"]
    ports:
      - "18556:18556"   # RPC port (simnet)
    volumes:
      - btcd-rpc:/rpc
      - btcd-data:/data
    networks:
      - lnd-simnet

  lnd:
    build:
      context: ${LND_SOURCE:-/users/roasbeef/gocode/src/github.com/lightningnetwork/lnd}
      dockerfile: dev.Dockerfile
    image: ${LND_IMAGE:-lnd:local}
    container_name: lnd-btcd
    restart: unless-stopped
    depends_on:
      - btcd
    environment:
      - BACKEND=btcd
      - RPCHOST=btcd
      - RPCUSER=devuser
      - RPCPASS=devpass
      - NETWORK=simnet
      - CHAIN=bitcoin
      - LND_DEBUG=${LND_DEBUG:-debug}
      - LND_EXTRA_ARGS=${LND_EXTRA_ARGS:-}
    entrypoint: ["./start-lnd.sh"]
    ports:
      - "9735:9735"     # Lightning P2P
      - "10009:10009"   # gRPC
      - "8080:8080"     # REST API
    volumes:
      - btcd-rpc:/rpc
      - lnd-btcd-data:/root/.lnd
    links:
      - "btcd:blockchain"
    networks:
      - lnd-simnet

volumes:
  btcd-rpc:
  btcd-data:
  lnd-btcd-data:

networks:
  lnd-simnet:
    driver: bridge
